import { useState } from 'react'
import { Link, NavLink, useLoaderData } from 'react-router'
import { searchProducts, useCurrentUser } from '../util';
import type { Burger } from '../util';
import './css/App.css'


function App() {
  const { products } = useLoaderData();
  const [productList, setProductList] = useState(products)
  const currentUser = useCurrentUser();

  const toggleLiked = (id: string) => {
    setProductList(productList.map((product: Burger) => {
      if (product.id === id) {
        return { ...product, liked: !product.liked };
      }
      return product;
    }))
  }

  return (
    <>
      <header className="home-header">
        <div>
          <h1 className='title'>Foodgo</h1>
          <p>Order your favorite food!</p>
        </div>
        <NavLink to={"/me"} className={"user"}>
          <picture>
            <img src={currentUser.avatar} alt="" className='user-avatar' />
          </picture>
        </NavLink>
      </header>
      <main className='home-main'>
        <div className='search-bar'>
          <div className='search-container'>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clipPath="url(#clip0_1_61)">
                <path d="M23.5612 21.4454L18.916 16.7983C22.3918 12.1535 21.444 5.57052 16.7993 2.0948C12.1545 -1.38092 5.5715 -0.433205 2.09578 4.21157C-1.37994 8.85634 -0.432228 15.4393 4.21255 18.9151C7.94361 21.7071 13.0682 21.7071 16.7993 18.9151L21.4464 23.5622C22.0304 24.1462 22.9772 24.1462 23.5611 23.5622C24.1451 22.9782 24.1451 22.0314 23.5611 21.4474L23.5612 21.4454ZM10.5446 18.0181C6.41658 18.0181 3.07017 14.6717 3.07017 10.5437C3.07017 6.4156 6.41658 3.06919 10.5446 3.06919C14.6727 3.06919 18.0191 6.4156 18.0191 10.5437C18.0147 14.6698 14.6709 18.0137 10.5446 18.0181Z" fill="#3C2F2F" />
              </g>
              <defs>
                <clipPath id="clip0_1_61">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>
            <input type="search" placeholder='search' name="filter-seach" id="filter-search" onChange={(v) => {
              const res = searchProducts(v.currentTarget.value);
              console.log("Search Results:", res);
              return setProductList(res);
            }} />
          </div>
          <button className='filter-button'>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" className='svg-primary'>
              <g clipPath="url(#clip0_1_59)">
                <path d="M10.7 2.62535C10.4188 2.02749 9.9733 1.522 9.41551 1.16794C8.85771 0.813871 8.21068 0.625854 7.55 0.625854C6.88932 0.625854 6.24229 0.813871 5.68449 1.16794C5.1267 1.522 4.68118 2.02749 4.4 2.62535H1.5C1.10218 2.62535 0.720644 2.78338 0.43934 3.06469C0.158035 3.34599 0 3.72752 0 4.12535H0C0 4.52317 0.158035 4.9047 0.43934 5.18601C0.720644 5.46731 1.10218 5.62535 1.5 5.62535H4.395C4.67618 6.2232 5.1217 6.7287 5.67949 7.08276C6.23729 7.43683 6.88432 7.62484 7.545 7.62484C8.20568 7.62484 8.85271 7.43683 9.41051 7.08276C9.9683 6.7287 10.4138 6.2232 10.695 5.62535H22.5C22.8978 5.62535 23.2794 5.46731 23.5607 5.18601C23.842 4.9047 24 4.52317 24 4.12535C24 3.72752 23.842 3.34599 23.5607 3.06469C23.2794 2.78338 22.8978 2.62535 22.5 2.62535H10.7Z" fill="white" />
                <path d="M16.455 8.49939C15.7944 8.50057 15.1477 8.68911 14.5899 9.04312C14.0321 9.39714 13.5863 9.90211 13.304 10.4994H1.5C1.10218 10.4994 0.720644 10.6574 0.43934 10.9387C0.158035 11.22 0 11.6016 0 11.9994H0C0 12.3972 0.158035 12.7787 0.43934 13.0601C0.720644 13.3414 1.10218 13.4994 1.5 13.4994H13.3C13.5812 14.0972 14.0267 14.6027 14.5845 14.9568C15.1423 15.3109 15.7893 15.4989 16.45 15.4989C17.1107 15.4989 17.7577 15.3109 18.3155 14.9568C18.8733 14.6027 19.3188 14.0972 19.6 13.4994H22.5C22.8978 13.4994 23.2794 13.3414 23.5607 13.0601C23.842 12.7787 24 12.3972 24 11.9994C24 11.6016 23.842 11.22 23.5607 10.9387C23.2794 10.6574 22.8978 10.4994 22.5 10.4994H19.605C19.3228 9.90226 18.8771 9.3974 18.3195 9.04339C17.762 8.68939 17.1154 8.50075 16.455 8.49939Z" fill="white" />
                <path d="M7.545 16.3744C6.88455 16.3758 6.23804 16.5644 5.68048 16.9184C5.12292 17.2724 4.67718 17.7773 4.395 18.3744H1.5C1.10218 18.3744 0.720644 18.5324 0.43934 18.8137C0.158035 19.095 0 19.4766 0 19.8744H0C0 20.2722 0.158035 20.6537 0.43934 20.935C0.720644 21.2163 1.10218 21.3744 1.5 21.3744H4.395C4.67618 21.9722 5.1217 22.4777 5.67949 22.8318C6.23729 23.1859 6.88432 23.3739 7.545 23.3739C8.20568 23.3739 8.85271 23.1859 9.41051 22.8318C9.9683 22.4777 10.4138 21.9722 10.695 21.3744H22.5C22.8978 21.3744 23.2794 21.2163 23.5607 20.935C23.842 20.6537 24 20.2722 24 19.8744C24 19.4766 23.842 19.095 23.5607 18.8137C23.2794 18.5324 22.8978 18.3744 22.5 18.3744H10.7C10.4175 17.7765 9.97094 17.2711 9.41241 16.9171C8.85388 16.563 8.2063 16.3748 7.545 16.3744Z" fill="white" />
              </g>
              <defs>
                <clipPath id="clip0_1_59">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>
          </button>
        </div>
        <div className='burger-list'>
          {productList.map((burger: Burger) => (
            <BurgerCard key={burger.id} burger={burger} toggleLiked={toggleLiked} />
          ))}
        </div>
      </main>


      <footer className='footer'>
        <svg width="430" viewBox="0 0 430 76" fill="none" xmlns="http://www.w3.org/2000/svg" className='svg-primary'>
          <path d="M161.5 21L179.59 20.6768C186.704 32.8337 199.898 41 215 41C230.625 41 244.208 32.2582 251.127 19.3994L273.5 19L285.5 0H437V90H-19V0H144.5L161.5 21Z" />
          <circle cx="144" cy="41" r="41"/>
          <circle cx="286" cy="41" r="41"/>
        </svg>
        <div className='footer-plus'>
          <svg width="114" height="114" viewBox="0 0 114 114" fill="none" xmlns="http://www.w3.org/2000/svg" className='svg-primary'>
            <g filter="url(#filter0_d_0_1)">
              <circle cx="57" cy="52" r="36" />
            </g>
            <path d="M49 52H65" stroke="white" strokeWidth="5" strokeLinecap="round" />
            <path d="M57 60V44" stroke="white" strokeWidth="5" strokeLinecap="round" />
          </svg>
        </div>

        <div className='footer-icons icons-left'>
          <NavLink to={"/"} className="footer-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_1_123)">
                <path d="M22.9747 8.69518L15.8887 1.60919C13.7393 -0.534728 10.2602 -0.534728 8.11071 1.60919L1.02472 8.69518C0.366223 9.35016 -0.00286988 10.2413 -0.00029176 11.1702V21.5481C0.00191136 22.9028 1.1001 24 2.45473 24.0011H21.5447C22.8993 24.0001 23.9975 22.9028 23.9997 21.5481V11.1702C24.0023 10.2413 23.6332 9.35016 22.9747 8.69518ZM20.9997 21.0012H15.9997V17.8191C15.9997 15.7105 14.2903 14.0011 12.1817 14.0011H11.8177C9.7091 14.0011 7.99971 15.7105 7.99971 17.8191V21.0012H2.9997V11.1702C3.00003 11.0376 3.05244 10.9104 3.14572 10.8162L10.2317 3.73019C11.2079 2.75373 12.7908 2.75355 13.7672 3.72972C13.7674 3.72986 13.7676 3.73004 13.7677 3.73019L20.8537 10.8162C20.9469 10.9104 20.9994 11.0376 20.9997 11.1702V21.0012H20.9997Z" fill="white" />
              </g>
              <defs>
                <clipPath id="clip0_1_123">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>
          </NavLink>
          <NavLink to={"/me"} className="footer-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_1_124)">
                <path d="M11.4524 14.0188C7.19063 14.404 3.94378 18.0051 4.00036 22.2838V22.5008C4.00036 23.3292 4.67194 24.0008 5.50036 24.0008C6.32878 24.0008 7.00036 23.3292 7.00036 22.5008V22.2238C6.95527 19.5967 8.89402 17.3564 11.5004 17.0238C14.2516 16.751 16.7031 18.7601 16.9759 21.5114C16.9921 21.674 17.0002 21.8373 17.0003 22.0008V22.5008C17.0003 23.3292 17.6719 24.0008 18.5003 24.0008C19.3288 24.0008 20.0003 23.3292 20.0003 22.5008V22.0008C19.9955 17.5775 16.4057 13.9957 11.9825 14.0006C11.8057 14.0008 11.6288 14.0069 11.4524 14.0188Z" fill="white" />
                <path d="M12.0004 12C15.3141 12 18.0004 9.31369 18.0004 6C18.0004 2.68631 15.3141 0 12.0004 0C8.68674 0 6.00043 2.68631 6.00043 6C6.00371 9.31233 8.6881 11.9967 12.0004 12ZM12.0004 3C13.6573 3 15.0004 4.34316 15.0004 6C15.0004 7.65684 13.6573 9 12.0004 9C10.3436 9 9.00043 7.65684 9.00043 6C9.00043 4.34316 10.3436 3 12.0004 3Z" fill="white" />
              </g>
              <defs>
                <clipPath id="clip0_1_124">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>

          </NavLink>
        </div>

        <div className='footer-icons icons-right'>
          <a href='https://chatgpt.com' className="footer-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_1_125)">
                <path d="M23.9998 11.2459C23.8548 8.90625 23.0283 6.66019 21.6223 4.78457C20.2163 2.90894 18.2922 1.48573 16.0871 0.690381C13.8821 -0.104971 11.4924 -0.237704 9.21287 0.308546C6.93329 0.854796 4.86338 2.05615 3.25828 3.76452C1.65318 5.47289 0.583065 7.6136 0.179837 9.92278C-0.223391 12.2319 0.0578963 14.6086 0.989026 16.7599C1.92016 18.9111 3.46043 20.7429 5.41997 22.0294C7.37952 23.3159 9.67268 24.0009 12.0168 23.9999H18.4998C19.9579 23.998 21.3558 23.418 22.3868 22.3869C23.4179 21.3559 23.9979 19.958 23.9998 18.4999V11.3399V11.2459ZM20.9998 18.4999C20.9998 19.1629 20.7364 19.7988 20.2676 20.2676C19.7987 20.7365 19.1628 20.9999 18.4998 20.9999H12.0168C10.7463 20.9991 9.49016 20.7306 8.33038 20.2118C7.1706 19.693 6.13319 18.9355 5.2858 17.9889C4.43465 17.0429 3.7956 15.9259 3.41151 14.7127C3.02742 13.4996 2.90716 12.2183 3.0588 10.9549C3.29806 8.96305 4.19322 7.10745 5.60324 5.68041C7.01326 4.25337 8.85799 3.33602 10.8468 3.07288C11.2359 3.02432 11.6277 2.99994 12.0198 2.99988C14.1159 2.99388 16.1474 3.7252 17.7588 5.06588C18.6982 5.84619 19.4697 6.80878 20.0267 7.89553C20.5837 8.98228 20.9148 10.1706 20.9998 11.3889V18.4999Z" fill="white" />
                <path d="M9.50012 11.0002H12.5001C12.8979 11.0002 13.2795 10.8421 13.5608 10.5608C13.8421 10.2795 14.0001 9.89798 14.0001 9.50015C14.0001 9.10233 13.8421 8.7208 13.5608 8.43949C13.2795 8.15819 12.8979 8.00015 12.5001 8.00015H9.50012C9.1023 8.00015 8.72077 8.15819 8.43946 8.43949C8.15816 8.7208 8.00012 9.10233 8.00012 9.50015C8.00012 9.89798 8.15816 10.2795 8.43946 10.5608C8.72077 10.8421 9.1023 11.0002 9.50012 11.0002Z" fill="white" />
                <path d="M16.5001 12.9998H9.50012C9.1023 12.9998 8.72077 13.1579 8.43946 13.4392C8.15816 13.7205 8.00012 14.102 8.00012 14.4998C8.00012 14.8977 8.15816 15.2792 8.43946 15.5605C8.72077 15.8418 9.1023 15.9998 9.50012 15.9998H16.5001C16.8979 15.9998 17.2795 15.8418 17.5608 15.5605C17.8421 15.2792 18.0001 14.8977 18.0001 14.4998C18.0001 14.102 17.8421 13.7205 17.5608 13.4392C17.2795 13.1579 16.8979 12.9998 16.5001 12.9998Z" fill="white" />
              </g>
              <defs>
                <clipPath id="clip0_1_125">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>

          </a>
          <NavLink to={"/liked"} className="footer-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <g clip-path="url(#clip0_1_122)">
                <path d="M17.5 1.91653C16.3739 1.93405 15.2724 2.24839 14.3067 2.82781C13.341 3.40722 12.5453 4.2312 12 5.21653C11.4546 4.2312 10.6589 3.40722 9.6932 2.82781C8.7275 2.24839 7.62601 1.93405 6.49996 1.91653C4.7049 1.99453 3.01366 2.77979 1.79574 4.10077C0.577818 5.42175 -0.0677922 7.17106 -4.17093e-05 8.96653C-4.17093e-05 13.5135 4.78596 18.4795 8.79996 21.8465C9.69618 22.5997 10.8293 23.0126 12 23.0126C13.1706 23.0126 14.3037 22.5997 15.2 21.8465C19.214 18.4795 24 13.5135 24 8.96653C24.0677 7.17106 23.4221 5.42175 22.2042 4.10077C20.9863 2.77979 19.295 1.99453 17.5 1.91653Z" fill="white" />
              </g>
              <defs>
                <clipPath id="clip0_1_122">
                  <rect width="24" height="24" fill="white" />
                </clipPath>
              </defs>
            </svg>

          </NavLink>
        </div>

      </footer>
    </>
  )
}

const BurgerCard = ({ burger, toggleLiked }: { burger: Burger, toggleLiked: (id: string) => void }) => {
  return (
    <Link to={"product/" + burger.id} className='burger-card'>
      <div className='imgWrapper'><img src={burger.image} alt={burger.name} className='burger-image' /></div>
      <div className='burger-info'>
        <h2 className='burger-name'>{burger.name}</h2>
        <p className='burger-summary'>{burger.summary}</p>
        <div className='burger-meta'>
          <span className='burger-rating'>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.9781 15.5435L8.00013 11.8848L3.02213 15.5435L4.93346 9.63481L-0.0418701 5.99948H6.1008L8.00013 0.0808105L9.89946 5.99948H16.0415L11.0668 9.63481L12.9781 15.5435Z" fill="#FF9633" />
            </svg>
            {burger.rating.toFixed(1)}</span>
          <button onClick={(e) => {
            e.preventDefault();
            toggleLiked(burger.id);
          }}>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="black" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={burger.liked ? "active" : ""}>
              <path d="M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5" />
            </svg>
          </button>
        </div>
      </div>
    </Link>
  )
}

export default App
